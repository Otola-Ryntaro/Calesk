# Global Principles

- 変更は常に最小限・安全・可逆的にする。
- 巧妙さよりも読みやすさ、複雑さよりもシンプルさを優先する。
- 新しい依存は本当に必要な場合のみ追加し、不要になったら削除する。
- 正確さを速度より優先する（小さなスピードより壊れないことが重要）。

## Global Workflow

- Plan: 大きめの変更を行う前に、短いプランを共有する。できるだけ小さくレビューしやすい差分に分割する。
- Read: 変更に関係するファイルを特定し、修正前に一通り読む。
- Verify: 外部 API や前提条件は必ずドキュメントで確認する。編集後は影響範囲を読み直し、構文・インデントを確認する。
- Implement: スコープを絞り、単一責務の関数・モジュールとして実装する。
- Test & Docs: 各変更で少なくとも 1 つテストを追加/更新し、必要に応じてドキュメントも更新する。
- Reflect: 表面的な修正ではなく根本原因を意識し、近接するリスクも含めて再発防止を考える。

**Checklist:** Plan → Read → Verify → Implement → Test + Docs → Reflect

## Collaboration & Accountability

- 要件があいまいな場合、セキュリティに関わる場合、UX / API 契約に影響する場合は必ず相談・エスカレートする。
- 自分のプランやコードに対する確信度が 80% 未満のときは、「不確実である」と明示して質問する。

## Global Code Style & Limits

- 1 ファイルあたりおおよそ 300 行以内を目安とし、モジュールはできるだけ単一責務に保つ。
- 各ファイルの先頭に簡潔なヘッダーコメント（where / what / why）を書く。
- 読み手にとって分かりにくい箇所にはコメントで意図や前提、トレードオフを書く。
- 実行時設定値は専用の config モジュール／ファイル（例: `config.py`）に集約し、コードやテスト内のマジックナンバーは避ける。
- 要求されていない機能や将来の拡張は実装しない（YAGNI）。

## Tools & MCP Usage

- ドキュメント参照や前提確認には、context7 (MCP server) を用いて常に最新の docs を取得する。
- ライブラリの API を利用する際は、`resolve-library-id` → `get-library-docs` の順で確認する。
- 複雑なコーディングが必要な場合は codex-cli を用いる（モデル指定はせずデフォルトを使用）。
- ブラウザ起動やブラウザテストが必要な場合は chrome-devtools を用いる。
- 不明点や前提が怪しいときは、MCP を使って確認しつつ、必ず質問・相談する。

## Docs & Todo Rules

- 要件定義書は機能ごとにチケットに分割し、`/docs` 配下にマークダウンとして保存する。
- ファイル名は連番付き（例: `001_ui_implementation.md`）とし、チケット単位で管理する。
- 各チケット内でタスクは `- [ ]` で列挙し、完了したら `- [x]` に変更する。

## Conversation Guidelines

- 会話は常に日本語で行う。

## Testing & TDD (Global)

- 原則としてテスト駆動開発（TDD）で進める。
- 期待される入出力に基づき、まずテストを追加し、その後に実装コードを記述する。
- 実装中はテストの意図を変えず、コード側を修正してテストを通す。
- 各変更で少なくとも 1 つはテストを追加・更新する。

## Worklog / 作業管理（必要な場合のみ）

- 日報を運用する場合は、`/daily_report` 配下に `[日報_y_m_d_h_m_v(version)].md` 形式で保存する。
- 作業中断時: `/nakajime` コマンドを使用する。
- 作業終了時: `/shime` コマンドを使用する。

— 

# Project-Specific Notes（各プロジェクトで追記）

このセクション以降は、プロジェクトごとにコピー後に必要に応じて追記する。

## Project Context
- プロジェクト概要: Webコラム効率記載のためのプロンプト
- 主な技術スタック: Claude code等で動く
- 想定ユーザー / ドメイン: メインユーザーのみ

## Important Project-Specific Rules
- 例: このリポジトリ固有の注意点、触ってはいけないディレクトリなど

## Key Directories / Commands
- 例: `src/`, `backend/`, `frontend/` などの役割
- 例: よく使うテスト・実行コマンド
---

## 🔄 Development Workflow（Harness + Codex連携）

### 基本フロー

```
計画 → 実装 → レビュー → 出荷
/plan-with-agent → /work → /harness-review + /codex-review → commit
```

1. **計画**: 機能追加・変更の前に `/plan-with-agent` で計画を作成する
2. **実装**: 計画を確認後、`/work` で並列実装を開始する（TDD推奨）
3. **レビュー**: 実装後、`/harness-review` で4視点レビュー（セキュリティ・パフォーマンス・品質・アクセシビリティ）を実施する
4. **セカンドオピニオン**: Codexによるセカンドオピニオンが必要な場合、`/codex-review` を実行する
5. **コミット**: 問題がなければコミットする

### 小さな修正の場合

計画不要な軽微な修正（typo、1行修正等）は直接実装してよい。
ただしコミット前に `/codex-review` でのチェックを推奨する。

## 📝 Codex Review Integration

コードレビューにはCodex MCP（セカンドオピニオン）を活用する。

- **通常のレビュー**: `mcp__codex-cli__review` を使用（MCP経由、コンテキスト消費約1/5）
- **構造化出力が必要な場合のみ**: Bash経由の `codex exec` にフォールバック
- **レビュー結果**: Claude 自身の分析と比較し、合意点・相違点を明示すること

### レビュータイミング

| タイミング | 方法 |
|-----------|------|
| コミット前 | `/codex-review` で未コミット変更をレビュー |
| PR作成前 | `/harness-review` + `/codex-review` の2段階レビュー |
| 重要な設計判断時 | Codex汎用プロンプトでセカンドオピニオン取得 |

## 🔧 実行コマンド

**テスト実行:**
```bash
source venv/bin/activate && python -m pytest tests/ -v --tb=short
```

**アプリケーション起動:**
```bash
python run_gui.py
```
